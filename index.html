<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Spotify Assignment</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
        <!-- BOOTSTRAP CDNs -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <!-- FONT -->
        <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

        <link rel="stylesheet" href="style.css">
        
        <script>
            $(document).ready(function(){
                $("form").submit(function(){
                    var text = $("#text").val()
                    var type = $("#type").val()
                    console.log(text, type)
                    $.get("https://api.spotify.com/v1/search?query=" + text + "&offset=0&limit=20&type=" + type, function(res) {
                        // console.log(res)

                        if(type == "track"){
                            console.log("inputted an track")
                            if(!res.tracks.items.length){
                                var html_string = "<h1>No Results Found</h1><br>";
                            } else {
                                var html_string = "<h1>Results:</h1><br>";
                            }

                            console.log(res.tracks.items)
                            for(var i = 0; i < res.tracks.items.length; i++){
                                console.log("name:", res.tracks.items[i].name)
                                console.log("artist:", res.tracks.items[i].artists[0].name)
                                console.log("albumURL:", res.tracks.items[i].album.images[0].url)
                                console.log("listen:", res.tracks.items[i].external_urls.spotify)

                                html_string += "<h4>#" + (i+1) + ".</h4>" +
                                            "<div id='divId" + (i+1) + "'><h4>Track Name: " + res.tracks.items[i].name +
                                            "</h4>" +
                                            "<h4>Artist Name: " + res.tracks.items[i].artists[0].name +
                                            "</h4>" +
                                            "<img height='75' src='" + res.tracks.items[i].album.images[0].url + "'></h4><a href='" + res.tracks.items[i].external_urls.spotify +
                                            "'><img id ='playbtn' src='images/playbtn2.png' alt='playbtn'></a></div><br><br><button class='btn btn-success btn-xs addBtn' data-btn-id='" + (i+1) + "'>Add to Favorites</button><hr>"
                            }
                        }

                        if(type == "artist"){
                            console.log("inputted an artist")

                            if(!res.artists.items.length){
                                var html_string = "<h1>No Results Found</h1><br>";
                            } else {
                                var html_string = "<h1>Results:</h1><br>";
                            }
                            // console.log(res.artists.items)
                            for(var i = 0; i < res.artists.items.length; i++){
                                console.log("name:", res.artists.items[i].name)
                                if(res.artists.items[i].images.length > 0){
                                    console.log("photo:", res.artists.items[i].images[0].url)
                                } else {
                                    console.log("no photo available")
                                }
                                console.log("listen:", res.artists.items[i].external_urls.spotify)
                                console.log("followers:", res.artists.items[i].followers.total)

                                html_string += "<h4>#" + (i+1) + ".</h4>" +
                                            "<h4>Artist Name: " + res.artists.items[i].name +
                                            "</h4><h5>Followers: " +
                                            res.artists.items[i].followers.total + "</h5>"


                                if(res.artists.items[i].images.length > 0){
                                    html_string += "<img height='75' src='" + res.artists.items[i].images[0].url + "'></h4>"
                                } else {
                                    html_string += "<img height='75' src='images/no_image.jpeg'></h4>"
                                }
                                html_string += "<a id='artistLink' href='" + res.artists.items[i].external_urls.spotify +
                                            "'>View Profile</a><hr>"
                            }
                        }

                        if(type == "album"){
                            console.log("inputted an album")
                            console.log(res)
                        }

                        $("#results").html(html_string)
                        $("#container").css( "height", 5700 );
                    })

                    return false;
                })
            })

            $(document).on("click", ".addBtn", function(){
                console.log("clicked btn!")
                var btn_id = $(this).attr('data-btn-id')
                music_html = document.getElementById("divId" + btn_id)
                $("#myMusic").prepend(music_html)
                $("#myMusic").prepend("<hr>")
            })
        </script>
    </head>
    <body>
        <div id="container">
            <div id="hero">
                <div id="inner-container">
                    <div id="header">
                        <img id="spotify-logo" src="images/spotify_logo.png" alt="spotify_logo">
                        <h2 id="head-text">Search your favorite tracks and artists using the Spotify API!</h2><br>

                        <form class="form-inline">
                            <div class="form-group">
                                <input id="text" type="text" class="form-control" placeholder="Search...">
                            </div>
                            <div class="form-group">
                                <select name="type" id="type" class="form-control">
                                    <option value="track">Track</option>
                                    <option value="artist">Artist</option>
                                    <!-- <option value="album">Album</option> -->
                                </select>
                            </div>
                            <input class="btn search-btn" type="submit" value="Search!">
                        </form>
                    </div>

                    <div id="results"></div>
                    <div id="musicList">
                        <h1><u>My Music</u></h1>
                        <div id="myMusic"><hr></div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
